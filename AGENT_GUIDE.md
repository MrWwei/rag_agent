# 医疗智能体系统 - Agent构建指南

## 📖 项目概述

本项目基于现有的医疗RAG问答系统，扩展实现了完整的智能体（Agent）功能，旨在帮助您学习和理解智能体的构建方案。

## 🧠 智能体构建方案详解

### 1. ReAct模式（Reasoning + Acting）

**核心思想**: 结合推理和行动的循环模式

```
用户问题 → 思考分析 → 选择工具 → 执行行动 → 观察结果 → 继续思考 → 最终回答
```

**实现文件**: `src/medical_agent.py`

**关键特性**:
- 多轮推理能力
- 工具选择和执行
- 可解释的决策过程
- 复杂任务分解

**适用场景**:
- 复杂医疗咨询
- 多步骤诊断推理
- 需要调用多个工具的任务

### 2. Function Calling模式

**核心思想**: 基于大模型的函数调用能力

```
用户问题 → 模型分析 → 选择函数 → 执行函数 → 返回结果
```

**实现文件**: `src/agent_tools.py`

**关键特性**:
- 直接函数调用
- 简单高效
- 易于扩展工具

**适用场景**:
- 明确的信息查询
- 单步骤任务
- 工具调用场景

### 3. Plan-and-Execute模式

**核心思想**: 先制定计划，再逐步执行

```
用户问题 → 制定计划 → 分解步骤 → 逐步执行 → 调整计划 → 完成任务
```

**适用场景**:
- 复杂项目管理
- 长期任务规划
- 多阶段执行

### 4. Multi-Agent协作模式

**核心思想**: 多个专门化智能体协同工作

```
任务分解 → 分配智能体 → 并行执行 → 结果整合 → 协调决策
```

**专门化智能体示例**:
- 诊断专家智能体
- 药物顾问智能体
- 急救评估智能体
- 健康管理智能体

### 5. 记忆增强模式

**核心思想**: 具备长期记忆和上下文管理

```
用户问题 → 检索历史 → 上下文融合 → 推理回答 → 更新记忆
```

**记忆类型**:
- 对话历史记忆
- 用户偏好记忆
- 领域知识记忆

## 🛠️ 技术架构

### 核心组件

```
┌─────────────────────────────────────────────┐
│                 用户接口                     │
├─────────────────────────────────────────────┤
│              智能体控制器                    │
│         (medical_agent.py)                 │
├─────────────────────────────────────────────┤
│    ReAct引擎  │  工具注册器  │  对话管理     │
├─────────────────────────────────────────────┤
│              RAG检索系统                     │
│         (rag_retriever.py)                 │
├─────────────────────────────────────────────┤
│    向量数据库  │  嵌入模型   │  知识库       │
├─────────────────────────────────────────────┤
│              大语言模型                      │
│           (OpenAI API)                     │
└─────────────────────────────────────────────┘
```

### 工具系统

本项目实现了6个专业医疗工具：

1. **medical_knowledge_search**: 医疗知识搜索
2. **symptom_analysis**: 症状分析诊断
3. **drug_information**: 药物信息查询
4. **health_advice**: 健康建议提供
5. **emergency_assessment**: 紧急情况评估
6. **department_recommendation**: 科室推荐

### 数据流程

```
1. 用户输入 → 智能体接收
2. ReAct循环开始:
   a. 思考: 分析问题需求
   b. 行动: 选择并执行工具
   c. 观察: 分析工具结果
   d. 重复: 直到获得足够信息
3. 综合分析 → 生成回答
4. 更新对话历史
```

## 🚀 快速开始

### 1. 环境准备

```bash
# 安装依赖
pip install -r requirements.txt

# 设置API密钥（在代码中配置）
# 编辑 src/medical_agent.py 中的 API_KEY
```

### 2. 测试工具功能

```bash
python test_agent_simple.py
```

选择选项1测试各种工具的功能。

### 3. 启动完整演示

```bash
python start_agent_system.py
```

### 4. 交互式对话

在演示系统中选择"交互式对话"进行实时测试。

## 📊 不同模式对比

| 特性 | ReAct | Function Call | Plan-Execute | Multi-Agent |
|------|-------|---------------|--------------|-------------|
| 推理能力 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 执行效率 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| 复杂度处理 | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 可解释性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 开发难度 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ |

## 🔧 自定义扩展

### 添加新工具

1. 在 `src/agent_tools.py` 中定义工具函数
2. 使用 `register_tool()` 注册工具
3. 定义工具的参数schema

```python
def my_new_tool(param1: str, param2: int) -> str:
    """新工具实现"""
    return "工具执行结果"

# 注册工具
tool_registry.register_tool(
    "my_new_tool",
    my_new_tool,
    "工具描述",
    {
        "type": "object",
        "properties": {
            "param1": {"type": "string", "description": "参数1描述"},
            "param2": {"type": "integer", "description": "参数2描述"}
        },
        "required": ["param1", "param2"]
    }
)
```

### 创建专门化智能体

```python
class SpecializedAgent(MedicalAgent):
    """专门化智能体"""
    
    def __init__(self, specialty: str, **kwargs):
        super().__init__(**kwargs)
        self.specialty = specialty
        self.system_prompt = self._build_specialized_prompt()
    
    def _build_specialized_prompt(self):
        return f"你是一个专门处理{self.specialty}的医疗智能体..."
```

## 📚 学习资源

### 推荐阅读

1. **ReAct论文**: "ReAct: Synergizing Reasoning and Acting in Language Models"
2. **LangChain文档**: 智能体构建指南
3. **OpenAI Function Calling**: 函数调用最佳实践

### 实践建议

1. **从简单开始**: 先理解单工具调用，再学习复杂推理
2. **观察日志**: 关注智能体的思考过程
3. **迭代改进**: 根据实际效果调整提示词和工具
4. **测试验证**: 构建完整的测试用例

## 🔍 常见问题

### Q1: 如何提高智能体的准确性？
A: 
- 优化提示词设计
- 增加领域知识
- 改进工具实现
- 使用更好的嵌入模型

### Q2: 如何处理复杂的多步骤任务？
A:
- 使用ReAct模式增加迭代次数
- 分解任务为更小的子任务
- 考虑使用Plan-Execute模式

### Q3: 如何扩展到其他领域？
A:
- 替换领域知识库
- 重新设计工具集
- 调整系统提示词
- 训练领域特定的嵌入模型

## 🎯 下一步计划

1. **多智能体协作**: 实现多个专门化智能体的协作
2. **记忆增强**: 添加长期记忆和个性化功能
3. **评估系统**: 构建智能体性能评估框架
4. **Web界面**: 开发友好的Web交互界面
5. **部署优化**: 优化模型推理和部署效率

## 📞 支持与贡献

如果您在使用过程中遇到问题或有改进建议，欢迎提交Issue或Pull Request。

---

**祝您学习愉快！🎉**
